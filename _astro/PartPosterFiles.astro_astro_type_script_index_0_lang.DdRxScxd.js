var w=Object.defineProperty,m=(n,t,e)=>t in n?w(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,c=(n,t,e)=>(m(n,typeof t!="symbol"?t+"":t,e),e);class v extends HTMLElement{constructor(){super();const t=this.closest("action-table");this.style.display="none",this.addEventListener("click",e=>{e.target instanceof HTMLButtonElement&&e.target.type==="reset"&&(this.dispatchEvent(new CustomEvent("action-table-filter",{bubbles:!0})),this.dispatchEvent(new CustomEvent("action-table-filters-reset",{bubbles:!0})))}),t.addEventListener("action-table",e=>{const s=e.detail;s?.rowsVisible===0?this.style.display="":this.style.display="none"})}}customElements.define("action-table-no-results",v);function y(n){return Object.keys(n).length>0}class C extends HTMLElement{constructor(){var t;if(super(),c(this,"table"),c(this,"tbody"),c(this,"cols",[]),c(this,"rows",[]),c(this,"filters",{}),c(this,"tableContent",new WeakMap),c(this,"rowsSet",new Set),c(this,"sortAndFilter",this.delayUntilNoLongerCalled(()=>{this.filterTable(),this.sortTable(),this.appendRows(),this.tbody.matches("[style*=none]")&&(this.rowsSet.size===0&&(this.setFilters(),this.dispatchEvent(new Event("action-table-filters-reset"))),this.tbody.style.display="")})),this.store){const e=this.getStore();e&&(this.sort=e.sort||this.sort,this.direction=e.direction||this.direction||"ascending",this.filters=e.filters||this.filters)}if(this.hasAttribute("urlparams")){const e=new URLSearchParams(window.location.search),s={};for(let[i,r]of e.entries())i=i.toLowerCase(),r=r.toLowerCase(),i!=="sort"&&i!=="direction"&&((t=s[i])!=null&&t.values?s[i].values.push(r):s[i]={values:[r]}),i==="sort"&&(this.sort=r),i==="direction"&&(r==="ascending"||r==="descending")&&(this.direction=r);Object.keys(s).length>0&&this.setFiltersObject(s)}this.addEventListeners()}get sort(){return this.getCleanAttr("sort")}set sort(t){this.setAttribute("sort",t)}get direction(){const t=this.getCleanAttr("direction");return t==="descending"?t:"ascending"}set direction(t){this.setAttribute("direction",t)}get store(){return this.hasAttribute("store")?this.getCleanAttr("store")||"action-table":""}get pagination(){return Number(this.getCleanAttr("pagination"))||0}set pagination(t){this.setAttribute("pagination",t.toString())}get page(){return Number(this.getCleanAttr("page"))||1}set page(t){t=this.checkPage(t),this.setAttribute("page",t.toString())}checkPage(t){return Math.max(1,Math.min(t,this.numberOfPages))}dispatch(t){this.dispatchEvent(new CustomEvent("action-table",{detail:t}))}getCleanAttr(t){var e;return((e=this.getAttribute(t))==null?void 0:e.trim().toLowerCase())||""}connectedCallback(){const t=this.querySelector("table");if(t&&t.querySelector("thead th")&&t.querySelector("tbody td"))this.table=t,this.tbody=t.querySelector("tbody"),this.rows=Array.from(this.tbody.querySelectorAll("tr")),this.rowsSet=new Set(this.rows);else throw new Error("Could not find table with thead and tbody");(this.sort||y(this.filters))&&(this.tbody.style.display="none",this.sortAndFilter()),this.getColumns(),this.addObserver()}static get observedAttributes(){return["sort","direction","pagination","page"]}attributeChangedCallback(t,e,s){e!==s&&this.rows.length>0&&((t==="sort"||t==="direction")&&this.sortTable(),t==="pagination"&&this.dispatch({pagination:this.pagination}),this.appendRows())}setFiltersObject(t={}){this.filters=t,this.store&&this.setStore({filters:this.filters})}setFilters(t={}){this.setFiltersObject(t),this.filterTable(),this.appendRows()}addEventListeners(){this.addEventListener("click",e=>{const s=e.target;if(s instanceof HTMLButtonElement&&s.dataset.col){const i=s.dataset.col;let r="ascending";this.sort===i&&this.direction==="ascending"&&(r="descending"),this.sort=i,this.direction=r,this.store&&this.setStore({sort:this.sort,direction:r})}},!1);const t=e=>e.matches("td")?e:e.closest("td");this.addEventListener("change",e=>{const s=e.target;s instanceof HTMLInputElement&&s.closest("td")&&s.type==="checkbox"&&this.updateCellValues(t(s))}),this.addEventListener("action-table-filter",e=>{if(e.detail){const s={...this.filters,...e.detail};Object.keys(s).forEach(i=>{s[i].values.every(r=>r==="")&&delete s[i]}),this.setFilters(s)}else this.setFilters()}),this.addEventListener("action-table-update",e=>{const s=e.target;if(s instanceof HTMLElement){let i={};typeof e.detail=="string"?i={sort:e.detail,filter:e.detail}:i=e.detail,this.updateCellValues(t(s),i)}})}getStore(){try{const t=localStorage.getItem(this.store),e=t&&JSON.parse(t);return typeof e=="object"&&e!==null&&["sort","direction","filters"].some(s=>s in e)?e:!1}catch{return!1}}setStore(t){const e=this.getStore()||{};e&&(t={...e,...t}),localStorage.setItem(this.store,JSON.stringify(t))}delayUntilNoLongerCalled(t){let e,s=!1;function i(){t(),s=!1}return function(){s?clearTimeout(e):s=!0,e=setTimeout(i,10)}}getColumns(){const t=this.table.querySelectorAll("thead th");if(t.forEach(e=>{const s=(e.dataset.col||this.getCellContent(e)).trim().toLowerCase(),i=e.dataset.order?e.dataset.order.split(","):void 0;if(this.cols.push({name:s,order:i}),!e.hasAttribute("no-sort")){const r=document.createElement("button");r.dataset.col=s,r.type="button",r.innerHTML=e.innerHTML,e.replaceChildren(r)}}),!this.table.querySelector("colgroup")){const e=document.createElement("colgroup");t.forEach(()=>{const s=document.createElement("col");e.appendChild(s)}),this.table.prepend(e)}}getCellContent(t){var e;let s=(t.textContent||"").trim();if(!s){const i=t.querySelector("svg");i instanceof SVGElement&&(s=((e=i.querySelector("title"))==null?void 0:e.textContent)||s);const r=t.querySelector("input[type=checkbox]");r instanceof HTMLInputElement&&r.checked&&(s=r.value);const o=t.querySelector(":defined");o!=null&&o.shadowRoot&&(s=o.shadowRoot.textContent||s)}return s.trim()}getCellValues(t){return this.tableContent.has(t)?this.tableContent.get(t):this.setCellValues(t)}setCellValues(t,e={}){const s=this.getCellContent(t),i={sort:t.dataset.sort||s,filter:t.dataset.filter||s,...e};return this.tableContent.set(t,i),i}updateCellValues(t,e={}){this.setCellValues(t,e),this.sortAndFilter()}addObserver(){new MutationObserver(t=>{t.forEach(e=>{let s=e.target;if(s.nodeType===3&&s.parentNode&&(s=s.parentNode),!(s instanceof HTMLElement))return;const i=s.closest("td");i instanceof HTMLTableCellElement&&(i.hasAttribute("contenteditable")&&i===document.activeElement?i.dataset.edit||(i.dataset.edit="true",i.addEventListener("blur",()=>{this.updateCellValues(i)})):this.updateCellValues(i))})}).observe(this.tbody,{childList:!0,subtree:!0,attributes:!0,characterData:!0,attributeFilter:["data-sort","data-filter"]})}filterTable(){const t=this.numberOfPages,e=this.rowsSet.size,s=this.filters["action-table"];this.rows.forEach(i=>{let r=!1;const o=i.querySelectorAll("td");if(s){const l=Array.from(o).filter((a,d)=>this.filters["action-table"].cols?this.filters["action-table"].cols.includes(this.cols[d].name.toLowerCase()):!0).map(a=>a.querySelector('input[type="checkbox"]')?"":this.getCellValues(a).filter).join(" ");this.shouldHide(s,l)&&(r=!0)}o.forEach((l,a)=>{const d=this.filters[this.cols[a].name];d&&this.shouldHide(d,this.getCellValues(l).filter)&&(r=!0)}),r?this.rowsSet.delete(i):this.rowsSet.add(i)}),this.numberOfPages!==t&&this.dispatch({numberOfPages:this.numberOfPages}),this.rowsSet.size!==e&&this.dispatch({rowsVisible:this.rowsSet.size})}shouldHide(t,e){if(t.values&&t.values.length>0){if(t.regex){let s=t.values.join("|");return t.exclusive&&(s=`${t.values.map(i=>`(?=.*${i})`).join("")}.*`),!new RegExp(s,"i").test(e)}if(t.range){const[s,i]=t.values;if(!isNaN(Number(s))&&!isNaN(Number(i)))return Number(e)<Number(s)||Number(e)>Number(i)}return t.exclusive?!t.values.every(s=>e.toLowerCase().includes(s.toLowerCase())):t.exact?t.values.every(s=>s&&s!==e):!t.values.some(s=>e.toLowerCase().includes(s.toLowerCase()))}return!1}sortTable(t=this.sort,e=this.direction){if(!this.sort||!e)return;t=t.toLowerCase();const s=this.cols.findIndex(i=>i.name===t);if(s>=0&&this.rows.length>0){const i=this.cols[s].order,r=o=>i!=null&&i.includes(o)?i.indexOf(o).toString():o;this.rows.sort((o,l)=>{if(e==="descending"){const f=o;o=l,l=f}const a=r(this.getCellValues(o.children[s]).sort),d=r(this.getCellValues(l.children[s]).sort);return this.alphaNumSort(a,d)}),this.querySelectorAll("col").forEach((o,l)=>{l===s?o.classList.add("sorted"):o.classList.remove("sorted")}),this.table.querySelectorAll("thead th").forEach((o,l)=>{const a=l===s?e:"none";o.setAttribute("aria-sort",a)})}}alphaNumSort(t,e){function s(o){if(isNaN(Number(o))){if(!isNaN(Date.parse(o)))return Date.parse(o)}else return Number(o)}const i=s(t),r=s(e);return i&&r?i-r:t.localeCompare(e)}appendRows(){const t=i=>{const{pagination:r,page:o}=this;return r===0||i>=r*(o-1)+1&&i<=r*o},e=document.createDocumentFragment();let s=0;if(this.rows.forEach(i=>{let r="none";this.rowsSet.has(i)&&(s++,t(s)&&(r="",e.appendChild(i))),i.style.display=r}),this.tbody.prepend(e),this.pagination>0){const i=this.checkPage(this.page);i!==this.page&&(this.page=i,this.dispatch({page:i}))}}get numberOfPages(){return this.pagination>0?Math.ceil(this.rowsSet.size/this.pagination):1}}customElements.define("action-table",C);const S="https://vagran.github.io/dxf-viewer-example/",E="https://jscad.app/",L="https://ochafik.com/openscad2/",A="https://stepbro.vercel.app/",x="https://3dviewer.net/",k="https://app.web3d.be/",N="https://3dviewer.net/",V="https://sharecad.org/",p=document.querySelector("article#arti"),h=p.dataset.base2,$=p.dataset.uiurl,u=document.querySelector("dialog#dBview"),b=document.querySelector("dialog#dBview > div"),q=document.querySelector("dialog#dBview > button.bback"),O=document.querySelectorAll("button.bview");function M(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function g(){M(b)}async function j(n){g();const t=document.createElement("textarea");b.appendChild(t),t.setAttribute("readonly",""),t.setAttribute("wrap","off"),t.style.width="100%",t.style.height="100%",t.style.backgroundColor="Pink",t.style.color="DarkBlue",t.style.resize="none";const e=await fetch(n);if(e.ok){const s=await e.text();t.value=s}u.showModal()}function H(n){g();const t=document.createElement("img");b.appendChild(t),t.setAttribute("src",n),t.setAttribute("alt",n),t.style.width="100%",t.style.height="100%",t.style.backgroundColor="Pink",u.showModal()}function T(n,t){if(["step","stp"].includes(t))window.open(A);else if(["stl"].includes(t)){const e=`${x}#model=${window.location.origin}${h}${n}`;window.open(e)}else if(["glb"].includes(t))window.open(k);else if(["brep"].includes(t))window.open(V);else if(["iges","igs","3mf"].includes(t))window.open(N);else if(["pxJson"].includes(t)){const e=`${$}?pxUrl=${window.location.origin}${h}${n}`;window.open(e)}else if(["txtLog","paxJson","jsManifold","pyFreecad"].includes(t))j(n);else if(["svg"].includes(t))H(n);else if(["dxf"].includes(t)){const e=`${S}?dxfUrl=${window.location.origin}${h}${n}`;window.open(e)}else if(["jsCad"].includes(t)){const e=`${E}#${window.location.origin}${h}${n}`;window.open(e)}else if(["scad"].includes(t)){const e=`${L}#url=${window.location.origin}${h}${n}`;window.open(e)}else console.log(`dbg722: the viewer of dfType ${t} is not defined`)}q.addEventListener("click",()=>{u.close(),g()});O.forEach(n=>n.addEventListener("click",()=>{const t=n.dataset.dfurl,e=n.dataset.dftype;T(t,e)}));
